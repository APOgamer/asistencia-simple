<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Asistencia Simple</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <h1>Sistema de Asistencia Simple</h1>
        
        <div class="upload-section">
            <div class="upload-box">
                <h3>Lista de Alumnos (Excel)</h3>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <select id="excelFileSelect" onchange="processExcel()">
                        <option value="">Seleccione un archivo Excel</option>
                    </select>
                    <button id="abrirExcelPreview" onclick="abrirExcelPreview()">Abrir Vista Previa</button>
                </div>
                <div id="excelPreviewBox" style="display:none; margin-top:10px;">
                    <button id="cerrarExcelPreview" style="margin-bottom:10px;" onclick="cerrarExcelPreview()">Cerrar Lista</button>
                    <div id="excelData"></div>
                </div>
            </div>

            <div class="upload-box">
                <h3>Archivo de Huellero (.dat)</h3>
                <div class="dat-upload">
                    <label class="custom-file-label">
                        <input type="file" id="datFile" accept=".dat" onchange="previewDatFile()">
                        Seleccionar archivo
                    </label>
                    <input type="date" id="attendanceDate" required>
                    <button onclick="uploadDatFile()">Subir Asistencia</button>
                </div>
                <button id="btnActualizarVistaPrevia" onclick="actualizarVistaPreviaDat()" style="margin-top:10px;width:100%;">Actualizar Vista Previa</button>
                <div id="datPreview" class="preview-box"></div>
                
                <!-- Selector de secciones para procesar -->
                <div id="seccionSelector" style="margin-top: 15px; display: none;">
                    <h4>Seleccionar Secciones a Procesar</h4>
                    <p style="font-size: 14px; color: #666; margin-bottom: 10px;">
                        Selecciona solo las secciones que quieres procesar para optimizar el rendimiento:
                    </p>
                    <div id="seccionesDisponibles" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-bottom: 15px;">
                        <!-- Las secciones se cargarán dinámicamente aquí -->
                    </div>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <button onclick="seleccionarTodasSecciones()" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">
                            Seleccionar Todas
                        </button>
                        <button onclick="deseleccionarTodasSecciones()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">
                            Deseleccionar Todas
                        </button>
                    </div>
                    <div style="background: #e9ecef; padding: 10px; border-radius: 4px; font-size: 14px;">
                        <strong>Secciones seleccionadas:</strong> <span id="seccionesSeleccionadas">Ninguna</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="results-section">
            <h2>Resultados</h2>
            <div id="excelResults" class="results-box">
                <h3>Lista de Alumnos</h3>
                <div id="excelData"></div>
                <button id="cerrarExcelPreview" style="display:none;margin:10px 0;" onclick="cerrarExcelPreview()">Cerrar Lista</button>
            </div>

            <div id="attendanceResults" class="results-box">
                <h3>Asistencias</h3>
                <div class="attendance-controls">
                    <div class="date-filter">
                        <label for="filterDate">Filtrar por fecha:</label>
                        <input type="date" id="filterDate" onchange="filterAttendance()">
                    </div>
                    <div class="attendance-actions">
                        <button onclick="selectAllAttendance()">Seleccionar Todo</button>
                        <button onclick="deselectAllAttendance()">Deseleccionar Todo</button>
                    </div>
                    <button onclick="calcularResumenMensajes()">Enviar Notificaciones</button>
                    <div class="cleanup-controls">
                        <button onclick="limpiarHistorialAsistencias()" class="cleanup-btn">Limpiar Historial Asistencias</button>
                        <button onclick="recargarListas()" class="cleanup-btn">Recargar Listas</button>
                        <button onclick="limpiarHistorialEntero()" class="cleanup-btn danger">Limpiar Historial Entero</button>
                    </div>
                </div>
                <div id="attendanceData"></div>
                <div class="whatsapp-section">
                    <h3>Enviar Notificaciones</h3>
                    <button onclick="calcularResumenMensajes()">Enviar a WhatsApp</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="js/app.js"></script>
</body>
</html> 